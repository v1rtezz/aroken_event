---

---

<div class="claude-widget">
  <button class="claude-widget-btn" data-claude-btn>
    <svg
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <circle cx="12" cy="12" r="10"></circle>
      <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
      <line x1="12" y1="17" x2="12.01" y2="17"></line>
    </svg>
  </button>

  <div class="claude-dropdown" data-claude-dropdown>
    <div class="claude-container">
      <div class="claude-header">
        <h3 class="claude-title">–ü–æ–¥—Å–∫–∞–∑–∫–∏ –æ—Ç –ö–ª–æ–¥–∞</h3>
      </div>
      <div class="claude-content">
        <div class="claude-messages" id="claude-messages"></div>
        <div class="claude-actions">
          <button
            class="claude-ask-btn"
            id="claude-ask-btn"
            data-hint-index="0"
          >
            –ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
          </button>
          <button
            class="claude-next-btn"
            id="claude-next-btn"
            style="display: none;"
          >
            –°–ª–µ–¥—É—é—â–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<style scoped>
  .claude-widget {
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .claude-widget-btn {
    width: 3.5vw;
    height: 3.5vw;
    border-radius: 50%;
    background: var(--theme-bg-hard, #1e1e1e);
    border: 1px solid var(--theme-border, #2d2d2d);
    color: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }

  .claude-widget-btn svg {
    width: 1.75vw;
    height: 1.75vw;
    transition: all 0.3s;
  }

  .claude-widget-btn:hover {
    background: var(--theme-accent-softer, #3d3d3d);
    border-color: var(--theme-accent-softer, #3d3d3d);
    transform: scale(1.1);
  }

  .claude-dropdown {
    position: absolute;
    right: calc(100% + 12px);
    top: 100px;
    transform: translateY(-50%);
    z-index: 1001;
    border-radius: 0.5rem;
    border: 1px solid var(--theme-border, #2d2d2d);
    background: var(--theme-bg-hard, #1e1e1e);
    padding: 0;
    min-width: 400px;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    transition:
      translate 0.3s,
      opacity 0.3s,
      scale 0.3s,
      visibility 0.3s;
    translate: 10px -50%;
    transform-origin: right center;
    opacity: 0;
    scale: 0.8;
    visibility: hidden;
    box-shadow: 0 0 20px 3px rgba(0, 0, 0, 0.5);
  }

  .claude-dropdown--active {
    translate: 0 -50%;
    opacity: 1;
    scale: 1;
    visibility: visible;
  }

  .claude-container {
    background: #1e1e1e;
    border-radius: 8px;
    padding: 20px;
    max-height: 600px;
    display: flex;
    flex-direction: column;
  }

  .claude-header {
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid #2d2d2d;
  }

  .claude-title {
    color: #e0e0e0;
    font-size: 18px;
    font-weight: 600;
    margin: 0;
    font-family:
      -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  }

  .claude-content {
    display: flex;
    flex-direction: column;
    gap: 16px;
    flex: 1;
    overflow-y: auto;
  }

  .claude-messages {
    min-height: 200px;
    max-height: 200px;
    overflow-y: auto;
    color: #e0e0e0;
    font-size: 15px;
    line-height: 1.6;
    font-family:
      -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  }

  .claude-message {
    margin-bottom: 16px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
  }

  .claude-message-user {
    margin-bottom: 16px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
    flex-direction: row-reverse;
  }

  .claude-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 600;
    flex-shrink: 0;
    padding: 0 4px;
    box-sizing: border-box;
  }

  .claude-avatar-claude {
    background: #4a9eff;
    color: #fff;
    width: auto;
    min-width: 36px;
    border-radius: 18px;
    font-size: 11px;
  }

  .claude-avatar-user {
    background: transparent;
    color: #fff;
    border: 2px solid #6b6b6b;
  }

  .claude-message-content {
    flex: 1;
    padding: 12px;
    background: #252525;
    border-radius: 8px;
    border-left: 3px solid #4a9eff;
  }

  .claude-message-content-user {
    flex: 1;
    padding: 12px;
    background: #2d2d2d;
    border-radius: 8px;
    border-right: 3px solid #6b6b6b;
  }

  .claude-typing {
    display: inline-block;
  }

  .claude-cursor {
    display: inline-block;
    width: 2px;
    height: 1em;
    background: #4a9eff;
    margin-left: 2px;
    animation: blink 1s infinite;
  }

  @keyframes blink {
    0%,
    50% {
      opacity: 1;
    }
    51%,
    100% {
      opacity: 0;
    }
  }

  .claude-thinking {
    flex: 1;
    padding: 12px;
    background: #252525;
    border-radius: 8px;
    border-left: 3px solid #4a9eff;
    display: flex;
    align-items: center;
    gap: 8px;
    color: #6b6b6b;
    font-style: italic;
  }

  .claude-thinking-dots {
    display: flex;
    gap: 4px;
  }

  .claude-thinking-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #6b6b6b;
    animation: thinking 1.4s infinite;
  }

  .claude-thinking-dot:nth-child(2) {
    animation-delay: 0.2s;
  }

  .claude-thinking-dot:nth-child(3) {
    animation-delay: 0.4s;
  }

  @keyframes thinking {
    0%,
    60%,
    100% {
      transform: translateY(0);
      opacity: 0.5;
    }
    30% {
      transform: translateY(-8px);
      opacity: 1;
    }
  }

  .claude-actions {
    display: flex;
    gap: 12px;
  }

  .claude-ask-btn,
  .claude-next-btn {
    flex: 1;
    padding: 12px 20px;
    background: #4a9eff;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
  }

  .claude-ask-btn:hover,
  .claude-next-btn:hover {
    background: #3a8eef;
    transform: translateY(-2px);
  }

  .claude-ask-btn:disabled,
  .claude-next-btn:disabled {
    background: #3d3d3d;
    cursor: not-allowed;
    transform: none;
  }

  .claude-messages::-webkit-scrollbar {
    width: 8px;
  }

  .claude-messages::-webkit-scrollbar-track {
    background: #1e1e1e;
  }

  .claude-messages::-webkit-scrollbar-thumb {
    background: #3d3d3d;
    border-radius: 4px;
  }

  .claude-messages::-webkit-scrollbar-thumb:hover {
    background: #4d4d4d;
  }
</style>

<script>
  const TARGET_SEQUENCE = "AROKENFIBERSON"
  const STORAGE_KEY = "letter_game_progress"
  const HINTS_COUNT_KEY = "claude_hints_count"
  const HINT_LEVEL_KEY = "claude_hint_levels" // Stores hint levels for each letter

  // 3-level hints per letter: [Level 1 (easy), Level 2 (medium), Level 3 (hard/direct)]
  const HINTS: Record<string, [string, string, string]> = {
    A: [
      "—Å —Ç–∞–∫–æ–π –∞–≤–∞—Ç–∞—Ä–∫–æ–π —Ç–µ–±–µ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–≤–µ—Ç–∏—Ç –∑–¥–µ—Å—å",
      "–ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Å–≤–æ—é –∞–≤–∞—Ç–∞—Ä–∫—É –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ",
      "–Ω–∞–∂–º–∏ –Ω–∞ —Å–≤–æ—é –∞–≤–∞—Ç–∞—Ä–∫—É –≤ —à–∞–ø–∫–µ —Å–∞–π—Ç–∞",
    ],
    R: [
      "–æ—â—É—â–µ–Ω–∏–µ, –±—É–¥—Ç–æ —Ç—ã –≤—Å–µ —Ç–∞–∫–∏ –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ –ø—Ä–æ—à–µ–ª –∫—É—Ä—Å.. –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Å–∫–∏–ª–ª—ã –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞–¥ –Ω–∏–º–∏",
      "–¢—ã –º–æ–∂–µ—à—å –¥–≤–∏–≥–∞—Ç—å –ø–æ–ª–∑—É–Ω–∫–∏ —Å–∫–∏–ª–ª–æ–≤, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞–¥ –Ω–∏–º–∏",
      "–ü–æ—á–µ–º—É —É 3 –∏ 5 –ø—É–Ω–∫—Ç–∞ –Ω–∞–ø–∏—Å–∞–Ω –º–∏–Ω—É—Å? –ú–æ–∂–µ—Ç –±—ã—Ç—å, —ç—Ç–æ –∑–Ω–∞–∫?",
    ],
    O: [
      "–µ—Å—Ç—å –µ—â–µ –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–º —ç–∫—Ä–∞–Ω–µ.. –ù–∞–π–¥–∏ –µ–µ",
      "—ç—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞—á–∏–≤–∫–∞—Ö",
      "–û–¥–Ω—É –∏–∑ –∞—á–∏–≤–æ–∫ –º–æ–∂–Ω–æ –ø—Ä–æ–∫–ª–∏–∫–∞—Ç—å",
    ],
    K: [
      "–ü–æ—Å–º–æ—Ç—Ä–∏ –∫–æ–¥ —Ç–µ–∫—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–ø—Ä–∞–≤–∞ –æ—Ç —É—Ä–æ–∫–æ–≤",
      "–ö–ª–∏–∫–Ω–∏ –Ω–∞ —É—Ä–æ–∫, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏—à–ª–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",
      "–î–∞ —Å—É–∫–∞ –Ω—É –Ω–∞–∂–º–∏ —Ç—ã —É–∂–µ –Ω–∞ —ç—Ç–æ—Ç —É—Ä–æ–∫ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ <p> –ø–æ–¥ —Ç–µ–∫—Å—Ç–æ–º —Å–ø—Ä–∞–≤–∞!!!!",
    ],
    E: [
      "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –µ—Å—Ç—å –≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–µ, –≥–¥–µ —Ç—ã –Ω–∞—à–µ–ª –±—É–∫–≤—É –ö",
      "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –µ—Å—Ç—å –≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–µ, –≥–¥–µ —Ç—ã –Ω–∞—à–µ–ª –±—É–∫–≤—É –ö",
      "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –µ—Å—Ç—å –≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–µ, –≥–¥–µ —Ç—ã –Ω–∞—à–µ–ª –±—É–∫–≤—É –ö",
    ],
    N: [
      "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –µ—Å—Ç—å –≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–µ, –≥–¥–µ —Ç—ã –Ω–∞—à–µ–ª –±—É–∫–≤—É –ö",
      "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –µ—Å—Ç—å –≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–µ, –≥–¥–µ —Ç—ã –Ω–∞—à–µ–ª –±—É–∫–≤—É –ö",
      "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –µ—Å—Ç—å –≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–µ, –≥–¥–µ —Ç—ã –Ω–∞—à–µ–ª –±—É–∫–≤—É –ö",
    ],
    F: [
      "–¢–µ–±–µ –µ—â–µ –Ω–µ –ø–æ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø–∞—É–∑—É? –ö–æ–≥–¥–∞ —Ç–∞–º –æ–±—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è?",
      "–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –¥–∞—Ç—É",
      "–î–∞ —Å—É–∫–∞ –¥–∞—Ç–∞ —ç—Ç–æ –∏ –µ—Å—Ç—å –∫–æ–¥",
    ],
    I: [
      "–ó–∞–≥–ª—è–Ω–∏ –ø–æ–≥–ª—É–±–∂–µ, –∫—É–¥–∞ –æ–±—ã—á–Ω—ã–π —é–∑–µ—Ä –Ω–µ –∑–∞–ª–µ–∑ –±—ã –ù–ò–ö–û–ì–î–ê –í –ñ–ò–ó–ù–ò, –Ω–æ –º—ã –ª–∞–∑–∏–º —á–∞—Å—Ç–æ",
      "—ç—Ç–æ –º–µ—Å—Ç–æ –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä–∞... –¢—É–¥–∞ –≤—ã–≤–æ–¥—è—Ç Hello World —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ—Ä—ã",
      "–æ—Ç–∫—Ä–æ–π Console –≤ DevTools –∏ –ø–æ—Å–º–æ—Ç—Ä–∏, —á—Ç–æ –≤—ã–≤–æ–¥–∏—Ç—Å—è",
    ],
    B: [
      "–ó–∞–≥–ª—è–Ω–∏ –ø–æ–≥–ª—É–±–∂–µ, –∫—É–¥–∞ –æ–±—ã—á–Ω—ã–π —é–∑–µ—Ä –Ω–µ –∑–∞–ª–µ–∑ –±—ã –ù–ò–ö–û–ì–î–ê –í –ñ–ò–ó–ù–ò, –Ω–æ –º—ã –ª–∞–∑–∏–º —á–∞—Å—Ç–æ",
      "–±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ... –ª–æ–∫–∞–ª—å–Ω–æ...",
      "–æ—Ç–∫—Ä–æ–π Application ‚Üí Local Storage –≤ DevTools –∏ –ø–æ—Å–º–æ—Ç—Ä–∏ –∫–ª—é—á 'POSHALKO'",
    ],
    S: [
      `–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ URL. –ú–∞—à–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ ‚Äî —ç—Ç–æ –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–ª–∏ –ø—Ä–∏—Å–ø–æ—Å–æ–±–ª–µ–Ω–∏–µ, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø—Ä–æ—à–ª–æ–µ –∏–ª–∏ –±—É–¥—É—â–µ–µ, –≤–æ–ø—Ä–µ–∫–∏ –µ–≥–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º—É –æ–¥–Ω–æ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–º—É —Ç–µ—á–µ–Ω–∏—é. –†–∞–∑—É–º–µ–µ—Ç—Å—è, –º–∞—à–∏–Ω—ã –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ —è —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ —Ç—ã –≤—Å–µ —Ç–∞–∫–∏ –º–æ–∂–µ—à—å –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞–∑–∞–¥.. –≤ —ç—Ç–æ–º –º–µ—Å—Ç–µ –≤—Å–ø–ª–∞–∫–Ω—É—Ç —Å—Ç–∞—Ä—ã–µ —É—á–µ–Ω–∏–∫–∏, –∞ –Ω–æ–≤—ã–µ –¥–∞–∂–µ –Ω–µ –ø–æ–π–º—É—Ç –æ —á–µ–º —Ä–µ—á—å..`,
      "–∏—Å—Ç–æ—Ä–∏—è... –°—Ç–∞—Ä—ã–µ —É—á–µ–Ω–∏–∫–∏–∏.. –°—Ç–∞—Ä–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞",
      "–∑–∞–º–µ–Ω–∏ platformAroken –Ω–∞ learnAroken –≤ —é—Ä–ª...",
    ],
  }

  function initClaude() {
    const btn = document.querySelector("[data-claude-btn]")
    const dropdown = document.querySelector("[data-claude-dropdown]")
    const askBtn = document.getElementById(
      "claude-ask-btn",
    ) as HTMLButtonElement | null
    const nextBtn = document.getElementById(
      "claude-next-btn",
    ) as HTMLButtonElement | null
    const messages = document.getElementById("claude-messages")

    if (!btn || !dropdown || !askBtn || !nextBtn || !messages) return

    // State to track which hints from the filtered list we have shown in this session

    // Load hint count from localStorage
    let hintCount = 0
    try {
      const savedCount = localStorage.getItem(HINTS_COUNT_KEY)
      if (savedCount === null) {
        localStorage.setItem(HINTS_COUNT_KEY, "0")
      } else {
        hintCount = parseInt(savedCount, 10) || 0
      }
    } catch (e) {
      console.error("Error loading hint count:", e)
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö dropdown
    function closeOtherDropdowns() {
      const otherDropdowns = document.querySelectorAll(
        "[data-notes-dropdown], [data-binary-dropdown], [data-letter-dropdown]",
      )
      otherDropdowns.forEach((otherDropdown) => {
        otherDropdown.classList.remove("notes-dropdown--active")
        otherDropdown.classList.remove("binary-dropdown--active")
        otherDropdown.classList.remove("letter-dropdown--active")
      })
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ dropdown
    btn.addEventListener("click", (e) => {
      e.stopPropagation()
      const isActive = dropdown.classList.contains("claude-dropdown--active")
      closeOtherDropdowns()
      if (isActive) {
        dropdown.classList.remove("claude-dropdown--active")
      } else {
        dropdown.classList.add("claude-dropdown--active")
      }
    })

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
    document.addEventListener("click", (e) => {
      if (
        !dropdown.contains(e.target as Node) &&
        !btn.contains(e.target as Node)
      ) {
        dropdown.classList.remove("claude-dropdown--active")
      }
    })

    // –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function showSending() {
      const messageDiv = document.createElement("div")
      messageDiv.className = "claude-message-user"

      const avatarDiv = document.createElement("div")
      avatarDiv.className = "claude-avatar claude-avatar-user"
      avatarDiv.textContent = "ME"

      const contentDiv = document.createElement("div")
      contentDiv.className = "claude-message-content-user"
      contentDiv.textContent = "–î–∞–π –ø–æ–¥—Å–∫–∞–∑–∫—É"

      messageDiv.appendChild(avatarDiv)
      messageDiv.appendChild(contentDiv)
      messages?.appendChild(messageDiv)

      // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
      if (messages) messages.scrollTop = messages.scrollHeight

      return new Promise((resolve) => {
        setTimeout(() => {
          resolve(null)
        }, 500)
      })
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è "–¥—É–º–∞–µ—Ç"
    function showThinking() {
      const messageDiv = document.createElement("div")
      messageDiv.className = "claude-message"

      const avatarDiv = document.createElement("div")
      avatarDiv.className = "claude-avatar claude-avatar-claude"
      avatarDiv.textContent = "Claude"

      const thinkingDiv = document.createElement("div")
      thinkingDiv.className = "claude-thinking"
      thinkingDiv.innerHTML = `
        –ö–ª–æ–¥ –¥—É–º–∞–µ—Ç
        <div class="claude-thinking-dots">
          <div class="claude-thinking-dot"></div>
          <div class="claude-thinking-dot"></div>
          <div class="claude-thinking-dot"></div>
        </div>
      `

      messageDiv.appendChild(avatarDiv)
      messageDiv.appendChild(thinkingDiv)
      messages?.appendChild(messageDiv)

      // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
      if (messages) messages.scrollTop = messages.scrollHeight

      return new Promise((resolve) => {
        setTimeout(() => {
          if (messages && messageDiv.parentNode === messages) {
            messages.removeChild(messageDiv)
          }
          resolve(null)
        }, 2000)
      })
    }

    // –ü–µ—á–∞—Ç—å —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ
    function typeText(text: string) {
      return new Promise<void>((resolve) => {
        const messageDiv = document.createElement("div")
        messageDiv.className = "claude-message"

        const avatarDiv = document.createElement("div")
        avatarDiv.className = "claude-avatar claude-avatar-claude"
        avatarDiv.textContent = "Claude"

        const contentDiv = document.createElement("div")
        contentDiv.className = "claude-message-content"

        const typingSpan = document.createElement("span")
        typingSpan.className = "claude-typing"
        const cursorSpan = document.createElement("span")
        cursorSpan.className = "claude-cursor"

        contentDiv.appendChild(typingSpan)
        contentDiv.appendChild(cursorSpan)
        messageDiv.appendChild(avatarDiv)
        messageDiv.appendChild(contentDiv)
        messages?.appendChild(messageDiv)

        // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
        if (messages) messages.scrollTop = messages.scrollHeight

        let index = 0
        const typingInterval = setInterval(() => {
          if (index < text.length) {
            typingSpan.textContent += text[index]
            index++
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–æ –≤—Ä–µ–º—è –ø–µ—á–∞—Ç–∏
            if (messages) messages.scrollTop = messages.scrollHeight
          } else {
            clearInterval(typingInterval)
            if (contentDiv.contains(cursorSpan)) {
              contentDiv.removeChild(cursorSpan)
            }
            resolve()
          }
        }, 50)
      })
    }

    // Helper: Get hint levels from localStorage
    function getHintLevels(): Record<string, number> {
      try {
        const saved = localStorage.getItem(HINT_LEVEL_KEY)
        if (saved) {
          return JSON.parse(saved)
        }
      } catch (e) {
        console.error("Error loading hint levels:", e)
      }
      return {}
    }

    // Helper: Save hint levels to localStorage
    function saveHintLevels(levels: Record<string, number>) {
      try {
        localStorage.setItem(HINT_LEVEL_KEY, JSON.stringify(levels))
      } catch (e) {
        console.error("Error saving hint levels:", e)
      }
    }

    // Helper: Find first unguessed letter in TARGET_SEQUENCE
    // Returns { letter, position } or null
    function findFirstUnguessedLetter(): {
      letter: string
      position: number
    } | null {
      try {
        const saved = localStorage.getItem(STORAGE_KEY)
        let foundLetters: string[] = []

        if (saved) {
          const data = JSON.parse(saved)
          foundLetters = data.foundLetters || []
        }

        // Create a copy of foundLetters to track what we've matched
        const remainingFound = [...foundLetters]

        // Iterate through TARGET_SEQUENCE to find first missing letter
        for (let i = 0; i < TARGET_SEQUENCE.length; i++) {
          const targetLetter = TARGET_SEQUENCE[i]
          const indexInFound = remainingFound.indexOf(targetLetter)

          if (indexInFound === -1) {
            // This letter hasn't been found yet - return it with position
            return { letter: targetLetter, position: i }
          } else {
            // Mark this letter as matched by removing it
            remainingFound.splice(indexInFound, 1)
          }
        }

        // All letters found
        return null
      } catch (e) {
        console.error("Error finding unguessed letter:", e)
        return null
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
    async function showHint() {
      // Find the first unguessed letter
      const result = findFirstUnguessedLetter()

      if (!result) {
        // All letters found
        await showSending()
        await showThinking()
        await typeText("–¢—ã —É–∂–µ –Ω–∞—à–µ–ª –≤—Å–µ –±—É–∫–≤—ã! –¢—ã –∫—Ä—É—Ç! üòé")

        if (askBtn) askBtn.disabled = true
        if (nextBtn) {
          nextBtn.disabled = true
          nextBtn.style.display = "none"
        }
        return
      }

      const { letter: targetLetter, position: targetPosition } = result

      // For positions after B (position 9+), use machine time hints
      let letterHints: [string, string, string] | undefined
      if (targetPosition >= 9) {
        // Use machine time hints for E, R, S, O, N (positions 9-13)
        letterHints = HINTS["S"]
      } else {
        letterHints = HINTS[targetLetter]
      }

      if (!letterHints) {
        await showSending()
        await showThinking()
        await typeText(
          `–£ –º–µ–Ω—è –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –±—É–∫–≤—ã. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∏—Å–∫–∞—Ç—å —Å–∞–º!`,
        )

        if (askBtn) askBtn.disabled = true
        if (nextBtn) {
          nextBtn.disabled = true
          nextBtn.style.display = "none"
        }
        return
      }

      // Get current hint level for this letter/position (1, 2, or 3)
      // Use position as key for letters after B to track them separately
      const hintLevels = getHintLevels()
      const hintKey =
        targetPosition >= 9 ? `pos_${targetPosition}` : targetLetter
      const currentLevel = hintLevels[hintKey] || 1

      // Check if we've exceeded max level
      if (currentLevel > 3) {
        await showSending()
        await showThinking()
        await typeText(
          `–¢—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –≤—Å–µ 3 —É—Ä–æ–≤–Ω—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –±—É–∫–≤—ã. –ü–æ–ø—Ä–æ–±—É–π –Ω–∞–π—Ç–∏ –µ—ë —Å–∞–º!`,
        )

        if (askBtn) askBtn.disabled = true
        if (nextBtn) {
          nextBtn.disabled = true
          nextBtn.style.display = "none"
        }
        return
      }

      // Get the hint text for current level (0-indexed array)
      const hintText = letterHints[currentLevel - 1]

      if (askBtn) askBtn.disabled = true
      if (nextBtn) nextBtn.disabled = true

      await showSending()
      await showThinking()
      await typeText(hintText)

      // Increment hint level for this letter/position
      hintLevels[hintKey] = currentLevel + 1
      saveHintLevels(hintLevels)

      // Increment and save global hint count
      hintCount++
      localStorage.setItem(HINTS_COUNT_KEY, hintCount.toString())

      // Dispatch custom event for milestone tracking
      window.dispatchEvent(
        new CustomEvent("hint-used", {
          detail: { count: hintCount },
        }),
      )

      // Check if this is the 10th hint
      if (hintCount >= 10) {
        // Wait 2 seconds, then clear localStorage and reload
        setTimeout(() => {
          localStorage.clear()
          window.location.reload()
        }, 2000)
        return
      }

      // Re-enable ask button for next hint
      if (askBtn) {
        askBtn.style.display = "block"
        askBtn.disabled = false
      }
      if (nextBtn) {
        nextBtn.style.display = "none"
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
    askBtn.addEventListener("click", showHint)
    nextBtn.addEventListener("click", () => {
      showHint()
    })
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initClaude)
  } else {
    initClaude()
  }

  // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å ViewTransitions
  document.addEventListener("astro:page-load", initClaude)
</script>
